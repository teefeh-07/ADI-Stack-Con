{"version":3,"file":"index.js","sources":["src/session.ts","src/providers.ts"],"sourcesContent":["const LOCAL_STORAGE_KEY = 'STX_PROVIDER';\n\nexport const getSelectedProviderId = (): string | null => {\n  if (typeof window === 'undefined') return null;\n  return window.localStorage.getItem(LOCAL_STORAGE_KEY);\n};\n\nexport const setSelectedProviderId = (provider: string) => {\n  if (typeof window !== 'undefined') {\n    window.localStorage.setItem(LOCAL_STORAGE_KEY, provider);\n  }\n};\n\nexport const clearSelectedProviderId = () => {\n  if (typeof window !== 'undefined') {\n    window.localStorage.removeItem(LOCAL_STORAGE_KEY);\n  }\n};\n","// AUTO REGISTERED PROVIDERS\n\nimport { getSelectedProviderId } from './session';\n\n/** Backwards compatible alias for `WbipProvider` */\nexport type WebBTCProvider = WbipProvider;\n\nexport interface WbipProvider {\n  /** The global \"path\" of the provider (e.g. `\"MyProvider\"` if registered at `window.MyProvider`) */\n  id: string;\n  /** The name of the provider, as displayed to the user */\n  name: string;\n  /** The data URL of an image to show (e.g. `data:image/png;base64,iVBORw0...`) @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URLs */\n  icon?: string;\n  /** Web URL of the provider */\n  webUrl?: string;\n\n  chromeWebStoreUrl?: string;\n  mozillaAddOnsUrl?: string;\n  googlePlayStoreUrl?: string;\n  iOSAppStoreUrl?: string;\n}\n\ndeclare global {\n  interface Window {\n    /**\n     * @experimental @beta\n     * An experimental global registry of providers that can be used by the UI to display a list of providers to the user.\n     * Wallets can add their provider to this list without needing to update `@stacks/connect` itself.\n     * This is an experimental API and may change in the future.\n     * This will be used as a test-run before switching to `webbtc` and WBIP004.\n     * The provider objects are WBIP004 compliant.\n     * It may happen that no wallet implements this feature before `@stacks/connect` switches to `webbtc`.\n     */\n    webbtc_stx_providers?: WbipProvider[];\n\n    /** @experimental @beta */\n    wbip_providers?: WbipProvider[];\n  }\n}\n\nexport const getRegisteredProviders = () => {\n  if (typeof window === 'undefined') return [];\n\n  const legacyProviders = window.webbtc_stx_providers || [];\n  const wbipProviders = window.wbip_providers || [];\n\n  return [...legacyProviders, ...wbipProviders];\n};\n\nexport const getInstalledProviders = (defaultProviders: WbipProvider[] = []) => {\n  if (typeof window === 'undefined') return [];\n\n  // Registered providers are installed by definition (they self-register)\n  const registeredProviders = getRegisteredProviders();\n\n  // Add default providers that are installed but didn't register themselves\n  const additionalInstalledProviders = defaultProviders.filter(dp => {\n    // Already registered, don't add again\n    if (registeredProviders.find(rp => rp.id === dp.id)) return false;\n\n    // Check if default provider is installed (even if not registered)\n    const provider = getProviderFromId(dp.id);\n    return !!provider;\n  });\n\n  return registeredProviders.concat(additionalInstalledProviders);\n};\n\n/**\n * Check if a wallet provider was previously selected via Connect.\n * @returns `true` if a provider was selected, `false` otherwise.\n */\nexport const isProviderSelected = () => {\n  return !!getSelectedProviderId();\n};\n\n/**\n * Get the currently selected wallet provider.\n * Note that this will not return the default `window.StacksProvider` object.\n * @returns The wallet provider object, or null if no provider is selected.\n */\nexport const getProvider = () => {\n  const providerId = getSelectedProviderId();\n  return getProviderFromId(providerId);\n};\n\nexport const getProviderFromId = (id: string | undefined) => {\n  return id?.split('.').reduce((acc, part) => acc?.[part], window);\n};\n"],"names":[],"mappings":"AAAA,MAAM,iBAAiB,GAAG,cAAc;AAEjC,MAAM,qBAAqB,GAAG,MAAoB;IACvD,IAAI,OAAO,MAAM,KAAK,WAAW;AAAE,QAAA,OAAO,IAAI;IAC9C,OAAO,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC;AACvD;AAEa,MAAA,qBAAqB,GAAG,CAAC,QAAgB,KAAI;AACxD,IAAA,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;QACjC,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,EAAE,QAAQ,CAAC;;AAE5D;AAEO,MAAM,uBAAuB,GAAG,MAAK;AAC1C,IAAA,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;AACjC,QAAA,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,iBAAiB,CAAC;;AAErD;;ACjBA;AAyCO,MAAM,sBAAsB,GAAG,MAAK;IACzC,IAAI,OAAO,MAAM,KAAK,WAAW;AAAE,QAAA,OAAO,EAAE;AAE5C,IAAA,MAAM,eAAe,GAAG,MAAM,CAAC,oBAAoB,IAAI,EAAE;AACzD,IAAA,MAAM,aAAa,GAAG,MAAM,CAAC,cAAc,IAAI,EAAE;AAEjD,IAAA,OAAO,CAAC,GAAG,eAAe,EAAE,GAAG,aAAa,CAAC;AAC/C;MAEa,qBAAqB,GAAG,CAAC,gBAAmC,GAAA,EAAE,KAAI;IAC7E,IAAI,OAAO,MAAM,KAAK,WAAW;AAAE,QAAA,OAAO,EAAE;;AAG5C,IAAA,MAAM,mBAAmB,GAAG,sBAAsB,EAAE;;IAGpD,MAAM,4BAA4B,GAAG,gBAAgB,CAAC,MAAM,CAAC,EAAE,IAAG;;AAEhE,QAAA,IAAI,mBAAmB,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;AAAE,YAAA,OAAO,KAAK;;QAGjE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,EAAE,CAAC,EAAE,CAAC;QACzC,OAAO,CAAC,CAAC,QAAQ;AACnB,KAAC,CAAC;AAEF,IAAA,OAAO,mBAAmB,CAAC,MAAM,CAAC,4BAA4B,CAAC;AACjE;AAEA;;;AAGG;AACI,MAAM,kBAAkB,GAAG,MAAK;AACrC,IAAA,OAAO,CAAC,CAAC,qBAAqB,EAAE;AAClC;AAEA;;;;AAIG;AACI,MAAM,WAAW,GAAG,MAAK;AAC9B,IAAA,MAAM,UAAU,GAAG,qBAAqB,EAAE;AAC1C,IAAA,OAAO,iBAAiB,CAAC,UAAU,CAAC;AACtC;AAEa,MAAA,iBAAiB,GAAG,CAAC,EAAsB,KAAI;AAC1D,IAAA,OAAO,EAAE,KAAA,IAAA,IAAF,EAAE,KAAA,MAAA,GAAA,MAAA,GAAF,EAAE,CAAE,KAAK,CAAC,GAAG,CAAA,CAAE,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,KAAK,GAAG,KAAA,IAAA,IAAH,GAAG,KAAA,MAAA,GAAA,MAAA,GAAH,GAAG,CAAG,IAAI,CAAC,EAAE,MAAM,CAAC;AAClE;;;;"}